(function(global){function YoutubePlayer(elementId,videoId){this.id=elementId;this.videoId=videoId;this.handlers={};this.embed();YoutubePlayer.register(this);}YoutubePlayer.prototype.embed=function(){var params={allowScriptAccess:'always'};var attrs={id:this.id};var videoUrl='http://www.youtube.com/v/{videoId}?enablejsapi=1&playerapiid={playerId}';videoUrl=videoUrl.replace('{videoId}',this.videoId);videoUrl=videoUrl.replace('{playerId}',this.id);if(!swfobject){throw new ReferenceError('YoutubePlayer depends on the SWFObject library but it is missing.');}swfobject.embedSWF(videoUrl,this.id,'425','356','8',null,null,params,attrs);};YoutubePlayer.prototype.on=function(eventName,handler){this.handlers[eventName]=this.handlers[eventName]||[];this.handlers[eventName].push(handler);};YoutubePlayer.prototype.onReady=function(){var player=document.getElementById(this.id);var callbackStr='YoutubePlayer.dispatchEvent("{id}")';var callback=callbackStr.replace("{id}",this.id);player.addEventListener('onStateChange',callback);};YoutubePlayer.prototype.notifyEvent=function(eventId){var states=YoutubePlayer.STATES;for(var eventName in states){if(states[eventName]==eventId){this.fireEvent(eventName);}}};YoutubePlayer.prototype.fireEvent=function(eventName){var handlers=this.handlers[eventName];if(!handlers){return;}for(var i=0;i<handlers.length;i++){handlers[i](eventName);}};YoutubePlayer.instances=[];YoutubePlayer.register=function(player){this.instances.push(player);};YoutubePlayer.findById=function(playerId){var player=null;for(var i=0;i<this.instances.length;i++){if(this.instances[i].id==playerId){player=this.instances[i];}}return player;};YoutubePlayer.dispatchEvent=function(playerId){var player=YoutubePlayer.findById(playerId);return function(eventId){player.notifyEvent(eventId);};};YoutubePlayer.STATES={unstarted:-1,ended:0,playing:1,paused:2,buffering:3,cued:5};global.YoutubePlayer=YoutubePlayer;global.onYouTubePlayerReady=function(playerId){playerId=decodeURI(playerId);YoutubePlayer.findById(playerId).onReady();};})(window);
